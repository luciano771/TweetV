 

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/pestaña.png" type="image/png">
    <title>TweetV</title>  



    <link rel="stylesheet" href="PublicacionesAI.css">
    <link rel="stylesheet" href="Modal.css">

    <script src="https://cdn.tailwindcss.com"></script>

 </head>
  <body>
    <!-- Contenedores donde se crearán los divs -->
    <div class="contenedor_principal">

      <!--Modal--->  
      <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="relative h-10 w-full min-w-[200px]">
                <br>
                <!---text area-->
                <div class="w-full max-w-xs mx-auto">
                  <textarea id="inp" x-data="{
                  resize () {
                  $el.style.height = '0px';
                  $el.style.height = $el.scrollHeight + 'px'
                  }
                  }"
                  x-init="resize()"
                  @input="resize()"
                  type="text"
                  placeholder="mmmmm 🤔 🙈 ..."
                  class="flex w-full h-auto min-h-[150px] px-3 py-2 text-sm bg-white border rounded-md border-neutral-300 ring-offset-background placeholder:text-neutral-400 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-400 disabled:cursor-not-allowed disabled:opacity-50"
                  ></textarea>
                  </div>
                <!---text area-->
                <br> 
                <button id="button1"onclick="toggleModal()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"> versionar &#128586;</button>
            </div>           
        </div>
      </div>
 
      <!--Modal--->
 
      <div class="contenedor_secundario"> 
        <div id="contenededor-spinner"><div id="posicion-spinner"><div id="spinner"></div></div></div>
          <button id="button1"onclick="toggleModal()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">En que estas pensando? &#128584;</button>
          <div id="mi-div">
            <div class = "item" id="1">Hoy amanecí como 🌧️ en Buenos Aires... Nublado sin ganas de salir de la cama ☁️😴 ¿Alguien más quiere hacer el día más interesante? #DomingoNoSéQuéHacer<button class="share"><img src="./img/share.png"></button></div>
            <div class = "item"id="2">¡Hola Argentina! ¿Alguien más se encuentra en modo indecisión hoy? 🤔 No sé si quedarme en casa y ver una peli o explorar nuevos lugares 🎬🌆 ¡Ayudenme con sus recomendaciones! #DomingoIndeciso<button class="share"><img src="./img/share.png"></button></div>
            <div class = "item"id="3">Muy buen día, mi gente hermosa de Argentina! 😄 Hoy estoy como un ☕️ sin azúcar... sin idea de qué hacer. ¿Me tiran alguna sugerencia? ¡Los leo! #DomingoSinPlan<button class="share"><img src="./img/share.png"></button></div>
            <div class = "item"id="4">¡Hola, argentinos y argentinas! 🇦🇷 Hoy me siento como un carrito 🛒 sin rumbo en un supermercado gigante 🛒 ¿Alguien quiere ser mi compañero(a) de aventuras y ayudarme a encontrar algo emocionante para hacer? 💃🎉 ¡Etiqueten a sus amigos y pongan el hashtag #DomingoIndeciso!<button class="share"><img src="./img/share.png"></button></div>
          </div>
      </div>
  </div>
  
  <script>
  
    
  async function Versionar(mensaje) {
  document.getElementById('contenededor-spinner').style.display = 'block';
  var url = "https://tweetv.onrender.com/openai";
  var data = { mensaje: mensaje };
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), 60000);

  await fetch(url, {
    signal: controller.signal,
    method: "POST",
    body: JSON.stringify(data),
    headers: {
      "Content-Type": "application/json",
    },
  })
    .then(response => response.json())
    .then(data => {
      document.getElementById('contenededor-spinner').style.display = 'none';
       
    
      for (const key in data) {
        const items = document.querySelectorAll('.item');
        const ultimoElemento = items[items.length - 1];
        ultimoID = parseInt(ultimoElemento.id);
      
        if (data.hasOwnProperty(key)) {
          const bannerDiv = document.createElement('div');
          bannerDiv.className = 'item';
          bannerDiv.id = ultimoID + 1;
 
          const textoElemento = document.createTextNode(data[key]);
          bannerDiv.appendChild(textoElemento);

          const shareButton = document.createElement('button');
          shareButton.className = 'share'; // Utilizamos una clase en lugar de un ID
          shareButton.innerHTML = '<img src="./img/share.png">';
          bannerDiv.appendChild(shareButton);
          
          const bannerContainer = document.getElementById('mi-div');
          bannerContainer.appendChild(bannerDiv);
          }
        }

      })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('contenededor-spinner').style.display = 'none';
    });
}

    
    
      document.addEventListener('DOMContentLoaded', function() {
          var modal = document.getElementById('myModal');
          var mensaje = document.getElementById('inp').value.trim();
          modal.style.display = 'none';
      });
    
      function toggleModal() {
          var modal = document.getElementById('myModal');
          var mensaje = document.getElementById('inp').value.trim();  
          if (modal.style.display === 'block') {
              modal.style.display = 'none';
              if(mensaje != ""){
                Versionar(mensaje);
              }
          } else {
              modal.style.display = 'block';
          }
      }

    
      window.onclick = function(event) {
          var modal = document.getElementById('myModal');
          if (event.target == modal) {
            modal.style.display = 'none';
            localStorage.setItem('modalOpened', 'false');
          }
      }
    
         document.addEventListener('keydown', function(event) {
          var mensaje = document.getElementById('inp').value.trim();
          var modal = document.getElementById('myModal');
          // console.log(event.key); // Verifica la tecla presionada
          // console.log(modal.style.display); // Verifica el estado de visualización del modal
          if (event.key === 'Enter' && modal.style.display === 'block') {
              console.log('Llamando a Versionar');
              toggleModal();
          }
      });
 
const itemsContainer = document.getElementById('mi-div');

itemsContainer.addEventListener('click', async function(event) {
    if (event.target.tagName === 'IMG' && event.target.parentElement.classList.contains('share')) {
        const textoDiv = event.target.parentElement.parentElement.textContent.trim();
        console.log(textoDiv);

        const access_token = await cookie();
        share(textoDiv, access_token);
    }
});



      
      async function cookie(){
          let access_token = "";
          const url = "https://tweetv.onrender.com/linkedin/cookie"
          await fetch(url, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
          })
          .then(response => response.json())
          .then(data => {
            console.log(data);
            access_token = data.accesstokenlinkedin;
          })
          .catch(error => {
            console.error('Error:', error);
            
          });

          return access_token;
          
      }




       function share(contenido,access_token){
        const cookies = document.cookie;
          if(!access_token){
            window.location.href = 'https://tweetv.onrender.com/linkedin';
            return
          }
          const mensaje = { "mensaje":  contenido };

          fetch('https://tweetv.onrender.com/linkedin/share', {
          method: "POST",
          body: JSON.stringify(mensaje),
          headers: {
            "Content-Type": "application/json",
          },
          })
          .then(response => response.json())
          .then(data => {
            console.log(data);
            const { id } = data; 
            const partes = id.split(':');
            const numero = partes[3];
            window.open("https://www.linkedin.com/in/lucianopereyra/recent-activity/all/" + numero, '_blank');
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }


  
     
    
        </script>
</body>
</html>
 